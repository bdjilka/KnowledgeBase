import Vue from 'vue';
import Component from 'vue-class-component';
import {aTypes as authActions} from '../../store/auth/actions';


@Component
class Auth extends Vue {
    mode = 'log';
    valid = false;

    username = null;
    password = null;
    password_dupe = null;
    email = null;

    email_rule = [
        v => !!v || 'E-mail is required',
        v => /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(v) || 'E-mail must be valid',
    ];

    field_required(value) {
        if (!value) {
            this.valid = false;
            return 'Field is required';
        } else {
            return true;
        }
    }

    password_rule(value) {
        if (!value || value.length < 8) {
            this.valid = false;
            return 'Password must have at least 8 characters';
        } else {
            return true;
        }
    }


    dupe_rule(value) {
        if (value !== this.password) {
            this.valid = false;
            return 'Passwords are not equal';
        } else {
            return true;
        }
    }

    async enter() {
        if (this.mode === 'log') {
            await this.sign_in();
        } else {
            await this.sign_up();
        }
    }

    async sign_in() {
        await this.$store.dispatch(
            authActions.login,
            {
                username: this.username,
                pswd: this.password,
            }
        )
    }

    async sign_up() {
        await this.$store.dispatch(
            authActions.signup,
            {
                username: this.username,
                pswd: this.password,
                email: this.email
            }
        )
    }
}

export default Auth;